# Income Tax Act Section 122.61 - Canada Child Benefit Tests
#
# Test cases for validating Canada Child Benefit calculations.
# Uses 2024-2025 benefit year amounts (July 2024 - June 2025).
#
# 2024-2025 CCB Maximum Amounts (annual):
#   - Under age 6: $7,787
#   - Age 6-17: $6,570
#
# Reduction thresholds and rates:
#   - No reduction below AFNI of $36,502
#   - First reduction: 7% (1 child) or 13.5% (2+ children) on AFNI $36,502 - $79,087
#   - Second reduction: 3.2% (1 child) or 5.7% (2+ children) on AFNI above $79,087
#
# Reference: https://www.canada.ca/en/revenue-agency/services/child-family-benefits/canada-child-benefit-overview.html

reference: "ITA Section 122.61"
benefit_year: "2024-2025"  # July 2024 - June 2025

tests:
  # ==========================================================================
  # MAXIMUM BENEFIT TESTS (no income reduction)
  # ==========================================================================

  # Test 1: Single child under 6, low income
  - name: "Single child under 6, zero income"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 0
    expected:
      ccb_amount: 7787
    notes: "Maximum benefit for one child under 6"

  # Test 2: Single child 6-17, low income
  - name: "Single child age 6-17, zero income"
    inputs:
      num_children_under_6: 0
      num_children_6_to_17: 1
      adjusted_family_net_income: 0
    expected:
      ccb_amount: 6570
    notes: "Maximum benefit for one child 6-17"

  # Test 3: Two children (one under 6, one 6-17), low income
  - name: "Two children mixed ages, zero income"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 1
      adjusted_family_net_income: 0
    expected:
      ccb_amount: 14357  # 7787 + 6570
    notes: "Maximum benefits for both children"

  # Test 4: Three children all under 6, low income
  - name: "Three children under 6, zero income"
    inputs:
      num_children_under_6: 3
      num_children_6_to_17: 0
      adjusted_family_net_income: 0
    expected:
      ccb_amount: 23361  # 7787 * 3
    notes: "Maximum benefits for three young children"

  # Test 5: At first threshold boundary
  - name: "One child under 6, at first threshold"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 36502
    expected:
      ccb_amount: 7787
    notes: "No reduction at exactly first threshold"

  # ==========================================================================
  # FIRST REDUCTION ZONE (AFNI $36,502 - $79,087)
  # ==========================================================================

  # Test 6: One child, slightly above first threshold
  - name: "One child under 6, just above first threshold"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 46502  # $10,000 above threshold
    expected:
      # Reduction: 7% of $10,000 = $700
      # CCB: $7,787 - $700 = $7,087
      ccb_amount: 7087
    notes: "7% reduction rate for one child"

  # Test 7: Two children, in first reduction zone
  - name: "Two children, middle of first reduction zone"
    inputs:
      num_children_under_6: 2
      num_children_6_to_17: 0
      adjusted_family_net_income: 56502  # $20,000 above threshold
    expected:
      # Max: 2 * $7,787 = $15,574
      # Reduction: 13.5% of $20,000 = $2,700
      # CCB: $15,574 - $2,700 = $12,874
      ccb_amount: 12874
    notes: "13.5% reduction rate for 2+ children"

  # Test 8: At second threshold boundary
  - name: "One child under 6, at second threshold"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 79087
    expected:
      # First reduction zone: $79,087 - $36,502 = $42,585
      # Reduction: 7% of $42,585 = $2,980.95 (rounded)
      # CCB: $7,787 - $2,981 = $4,806
      ccb_amount: 4806
    notes: "At transition to second reduction rate"

  # ==========================================================================
  # SECOND REDUCTION ZONE (AFNI above $79,087)
  # ==========================================================================

  # Test 9: One child, above second threshold
  - name: "One child under 6, above second threshold"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 100000
    expected:
      # First zone reduction: 7% of $42,585 = $2,980.95
      # Second zone: $100,000 - $79,087 = $20,913
      # Second zone reduction: 3.2% of $20,913 = $669.22
      # Total reduction: $2,980.95 + $669.22 = $3,650.17
      # CCB: $7,787 - $3,650 = $4,137 (approximately)
      ccb_amount: 4137
    notes: "Combined first and second zone reductions"

  # Test 10: Two children, high income
  - name: "Two children, high income household"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 1
      adjusted_family_net_income: 150000
    expected:
      # Max: $7,787 + $6,570 = $14,357
      # First zone: 13.5% of $42,585 = $5,748.98
      # Second zone: $150,000 - $79,087 = $70,913
      # Second zone reduction: 5.7% of $70,913 = $4,042.04
      # Total reduction: $5,749 + $4,042 = $9,791
      # CCB: $14,357 - $9,791 = $4,566
      ccb_amount: 4566
    notes: "High income with mixed age children"

  # Test 11: Benefit phases out completely
  - name: "Single child, very high income - no benefit"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 250000
    expected:
      # Reduction exceeds maximum benefit
      ccb_amount: 0
    notes: "CCB phases out at high income levels"

  # ==========================================================================
  # SPECIAL CASES
  # ==========================================================================

  # Test 12: No children
  - name: "No children"
    inputs:
      num_children_under_6: 0
      num_children_6_to_17: 0
      adjusted_family_net_income: 50000
    expected:
      ccb_amount: 0
    notes: "Must have qualified dependants"

  # Test 13: Large family
  - name: "Five children, various ages"
    inputs:
      num_children_under_6: 2
      num_children_6_to_17: 3
      adjusted_family_net_income: 60000
    expected:
      # Max: 2*$7,787 + 3*$6,570 = $15,574 + $19,710 = $35,284
      # Reduction zone: $60,000 - $36,502 = $23,498
      # Rate for 2+ children: 13.5%
      # Reduction: $23,498 * 0.135 = $3,172.23
      # CCB: $35,284 - $3,172 = $32,112
      ccb_amount: 32112
    notes: "Large family with higher reduction rate"

  # Test 14: Monthly payment check
  - name: "Monthly CCB payment calculation"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 36502
    expected:
      ccb_amount: 7787
      ccb_monthly: 648.92  # $7,787 / 12 = $648.92
    notes: "Monthly payment is annual divided by 12"

  # Test 15: Shared custody (50% reduction)
  - name: "Shared custody - 50% of benefit"
    inputs:
      num_children_under_6: 1
      num_children_6_to_17: 0
      adjusted_family_net_income: 0
      shared_custody: true
    expected:
      ccb_amount: 3893.50  # 7787 / 2
    notes: "Each parent gets 50% when custody is shared equally"
