# Income Tax Act Section 122.5 - GST/HST Credit Tests
#
# Test cases for validating GST/HST Credit calculations.
# Uses July 2024 - June 2025 payment year amounts.
#
# 2024-2025 GST/HST Credit Maximum Amounts (annual):
#   - Single individual: $519
#   - Spouse/common-law partner: $519
#   - Each child under 19: $171
#   - Single supplement: $171
#
# Phase-out:
#   - Threshold: $44,324 (individual) or $58,840 (family)
#   - Rate: 5%
#
# Payments made quarterly: July, October, January, April
#
# Reference: https://www.canada.ca/en/revenue-agency/services/child-family-benefits/goods-services-tax-harmonized-sales-tax-gst-hst-credit.html

reference: "ITA Section 122.5"
benefit_year: "2024-2025"

tests:
  # ==========================================================================
  # MAXIMUM BENEFIT TESTS (no income reduction)
  # ==========================================================================

  # Test 1: Single individual, no children, zero income
  - name: "Single individual, zero income"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 0
    expected:
      gst_hst_credit: 519
      gst_hst_credit_quarterly: 129.75
    notes: "Maximum single individual credit: $519/year or $129.75/quarter"

  # Test 2: Single with single supplement
  - name: "Single individual with single supplement"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 0
      qualifies_for_single_supplement: true
    expected:
      # Single: $519 + Single supplement: $171 = $690
      gst_hst_credit: 690
    notes: "Single supplement added for eligible singles"

  # Test 3: Married couple, no children
  - name: "Married couple, no children, zero income"
    inputs:
      is_married_or_common_law: true
      num_children_under_19: 0
      adjusted_family_net_income: 0
    expected:
      # Individual: $519 + Spouse: $519 = $1,038
      gst_hst_credit: 1038
    notes: "Maximum for couple without children"

  # Test 4: Married couple with children
  - name: "Married couple with two children"
    inputs:
      is_married_or_common_law: true
      num_children_under_19: 2
      adjusted_family_net_income: 0
    expected:
      # Individual: $519 + Spouse: $519 + 2 children: $342 = $1,380
      gst_hst_credit: 1380
    notes: "Couple with 2 children at maximum"

  # Test 5: Single parent with children
  - name: "Single parent with one child"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 1
      adjusted_family_net_income: 0
    expected:
      # Individual: $519 + equivalent-to-spouse for child: $519 = $1,038
      # First child replaces spouse amount for single parent
      gst_hst_credit: 1038
    notes: "Single parent - first child gets spouse equivalent"

  # Test 6: Single parent with multiple children
  - name: "Single parent with three children"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 3
      adjusted_family_net_income: 0
    expected:
      # Individual: $519 + Spouse equiv (first child): $519 + 2 more children: $342 = $1,380
      gst_hst_credit: 1380
    notes: "Single parent - first child as spouse equiv, rest as children"

  # ==========================================================================
  # PHASE-OUT TESTS
  # ==========================================================================

  # Test 7: Single, at phase-out threshold
  - name: "Single, at phase-out threshold"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 44324
    expected:
      gst_hst_credit: 519
    notes: "No reduction at exactly threshold"

  # Test 8: Single, above threshold
  - name: "Single, income above threshold"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 54324  # $10,000 above threshold
    expected:
      # Reduction: 5% of $10,000 = $500
      # Credit: $519 - $500 = $19
      gst_hst_credit: 19
    notes: "5% phase-out rate"

  # Test 9: Single, fully phased out
  - name: "Single, high income - no credit"
    inputs:
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 60000
    expected:
      # Reduction: 5% of ($60,000 - $44,324) = $784
      # Exceeds maximum of $519
      gst_hst_credit: 0
    notes: "Credit fully phased out"

  # Test 10: Family, at family threshold
  - name: "Married couple at family threshold"
    inputs:
      is_married_or_common_law: true
      num_children_under_19: 0
      adjusted_family_net_income: 58840
    expected:
      gst_hst_credit: 1038
    notes: "Family threshold is higher"

  # Test 11: Family, above threshold
  - name: "Married couple above threshold"
    inputs:
      is_married_or_common_law: true
      num_children_under_19: 2
      adjusted_family_net_income: 78840  # $20,000 above family threshold
    expected:
      # Max: $1,380
      # Reduction: 5% of $20,000 = $1,000
      # Credit: $1,380 - $1,000 = $380
      gst_hst_credit: 380
    notes: "Family with income above threshold"

  # ==========================================================================
  # ELIGIBILITY TESTS
  # ==========================================================================

  # Test 12: Age requirement (must be 19+)
  - name: "Under 19, not eligible unless special circumstances"
    inputs:
      age: 18
      is_married_or_common_law: false
      has_children: false
      adjusted_family_net_income: 0
    expected:
      gst_hst_credit: 0
    notes: "Must be 19+ to receive GST/HST credit (exceptions apply)"

  # Test 13: Non-resident not eligible
  - name: "Non-resident not eligible"
    inputs:
      is_canadian_resident: false
      is_married_or_common_law: false
      num_children_under_19: 0
      adjusted_family_net_income: 0
    expected:
      gst_hst_credit: 0
    notes: "Must be Canadian resident for tax purposes"

  # ==========================================================================
  # QUARTERLY PAYMENT TESTS
  # ==========================================================================

  # Test 14: Quarterly payment amounts
  - name: "Quarterly payment calculation"
    inputs:
      is_married_or_common_law: true
      num_children_under_19: 2
      adjusted_family_net_income: 40000
    expected:
      gst_hst_credit: 1380
      gst_hst_credit_quarterly: 345
    notes: "Quarterly = Annual / 4"
