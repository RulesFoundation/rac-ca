# Income Tax Act Section 122.7 - Canada Workers Benefit Tests
#
# Test cases for validating Canada Workers Benefit (CWB) calculations.
# Uses 2024 tax year amounts.
#
# 2024 CWB Amounts:
# Basic:
#   - Maximum single: $1,518
#   - Maximum family: $2,616
#   - Phase-in rate: 27%
#   - Phase-out rate: 15%
#   - Single: phase-in starts $3,000, phase-out starts $25,036
#   - Family: phase-in starts $3,000, phase-out starts $28,494
#
# Disability Supplement:
#   - Maximum: $784
#   - Phase-in rate: 27%
#   - Phase-out rate: 15%
#   - Phase-in starts: $1,150
#   - Phase-out starts: Same as basic benefit thresholds
#
# Reference: https://www.canada.ca/en/revenue-agency/services/child-family-benefits/cwb.html

reference: "ITA Section 122.7"
tax_year: 2024

tests:
  # ==========================================================================
  # BASIC BENEFIT - SINGLE INDIVIDUAL TESTS
  # ==========================================================================

  # Test 1: Zero income - no CWB (below phase-in threshold)
  - name: "Single, zero income - no benefit"
    inputs:
      is_family: false
      working_income: 0
      adjusted_net_income: 0
      is_disabled: false
    expected:
      cwb_basic: 0
    notes: "Must have working income above $3,000 to qualify"

  # Test 2: At phase-in threshold
  - name: "Single, at phase-in threshold"
    inputs:
      is_family: false
      working_income: 3000
      adjusted_net_income: 3000
      is_disabled: false
    expected:
      cwb_basic: 0
    notes: "Phase-in begins above $3,000"

  # Test 3: In phase-in zone
  - name: "Single, in phase-in zone"
    inputs:
      is_family: false
      working_income: 8000
      adjusted_net_income: 8000
      is_disabled: false
    expected:
      # Phase-in: 27% of ($8,000 - $3,000) = 27% of $5,000 = $1,350
      cwb_basic: 1350
    notes: "Building up to maximum"

  # Test 4: At maximum (before phase-out)
  - name: "Single, at maximum CWB"
    inputs:
      is_family: false
      working_income: 10000
      adjusted_net_income: 10000
      is_disabled: false
    expected:
      # Phase-in: 27% of ($10,000 - $3,000) = $1,890, capped at $1,518
      cwb_basic: 1518
    notes: "Maximum single benefit"

  # Test 5: In plateau zone (between phase-in cap and phase-out start)
  - name: "Single, in plateau zone"
    inputs:
      is_family: false
      working_income: 20000
      adjusted_net_income: 20000
      is_disabled: false
    expected:
      cwb_basic: 1518
    notes: "Still at maximum, below phase-out threshold"

  # Test 6: At phase-out threshold
  - name: "Single, at phase-out threshold"
    inputs:
      is_family: false
      working_income: 25036
      adjusted_net_income: 25036
      is_disabled: false
    expected:
      cwb_basic: 1518
    notes: "No reduction at exactly threshold"

  # Test 7: In phase-out zone
  - name: "Single, in phase-out zone"
    inputs:
      is_family: false
      working_income: 30000
      adjusted_net_income: 30000
      is_disabled: false
    expected:
      # Reduction: 15% of ($30,000 - $25,036) = 15% of $4,964 = $744.60
      # CWB: $1,518 - $745 = $773
      cwb_basic: 773
    notes: "15% phase-out rate"

  # Test 8: Fully phased out
  - name: "Single, fully phased out"
    inputs:
      is_family: false
      working_income: 40000
      adjusted_net_income: 40000
      is_disabled: false
    expected:
      # Reduction: 15% of ($40,000 - $25,036) = $2,244.60 > $1,518
      cwb_basic: 0
    notes: "Benefit fully phased out"

  # ==========================================================================
  # BASIC BENEFIT - FAMILY TESTS
  # ==========================================================================

  # Test 9: Family at maximum
  - name: "Family, at maximum CWB"
    inputs:
      is_family: true
      working_income: 15000
      adjusted_net_income: 15000
      is_disabled: false
    expected:
      # Phase-in: 27% of ($15,000 - $3,000) = $3,240, capped at $2,616
      cwb_basic: 2616
    notes: "Maximum family benefit"

  # Test 10: Family in phase-out zone
  - name: "Family, in phase-out zone"
    inputs:
      is_family: true
      working_income: 35000
      adjusted_net_income: 35000
      is_disabled: false
    expected:
      # Reduction: 15% of ($35,000 - $28,494) = 15% of $6,506 = $975.90
      # CWB: $2,616 - $976 = $1,640
      cwb_basic: 1640
    notes: "Family phase-out"

  # Test 11: Family, income below working income (different ANI)
  - name: "Family with deductions"
    inputs:
      is_family: true
      working_income: 35000
      adjusted_net_income: 25000  # Lower due to RRSP contributions etc.
      is_disabled: false
    expected:
      # Phase-out uses adjusted net income
      # ANI $25,000 < threshold $28,494, so no reduction
      cwb_basic: 2616
    notes: "Phase-out based on ANI, not working income"

  # ==========================================================================
  # DISABILITY SUPPLEMENT TESTS
  # ==========================================================================

  # Test 12: Disabled single, low income
  - name: "Disabled single, in disability supplement phase-in"
    inputs:
      is_family: false
      working_income: 5000
      adjusted_net_income: 5000
      is_disabled: true
    expected:
      # Basic: 27% of ($5,000 - $3,000) = $540
      # Disability: 27% of ($5,000 - $1,150) = 27% of $3,850 = $1,039.50, capped at $784
      cwb_basic: 540
      cwb_disability: 784
      cwb_total: 1324
    notes: "Disability supplement phases in from $1,150"

  # Test 13: Disabled single, maximum benefits
  - name: "Disabled single, maximum both benefits"
    inputs:
      is_family: false
      working_income: 15000
      adjusted_net_income: 15000
      is_disabled: true
    expected:
      cwb_basic: 1518
      cwb_disability: 784
      cwb_total: 2302
    notes: "Maximum basic + disability"

  # Test 14: Disabled single, phase-out
  - name: "Disabled single, in phase-out zone"
    inputs:
      is_family: false
      working_income: 30000
      adjusted_net_income: 30000
      is_disabled: true
    expected:
      # Basic reduction: 15% of $4,964 = $744.60
      # Basic: $1,518 - $745 = $773
      # Disability reduction: 15% of $4,964 = $744.60
      # Disability: $784 - $745 = $39
      cwb_basic: 773
      cwb_disability: 39
      cwb_total: 812
    notes: "Both benefits phase out together"

  # ==========================================================================
  # ELIGIBILITY TESTS
  # ==========================================================================

  # Test 15: Student (special eligibility rules)
  - name: "Full-time student, eligible if 19+"
    inputs:
      is_family: false
      working_income: 10000
      adjusted_net_income: 10000
      is_disabled: false
      is_full_time_student: true
      age: 22
      months_in_school: 4
    expected:
      # Eligible if 19+ and not student for more than 13 weeks in month before filing
      cwb_basic: 1518
    notes: "Students 19+ may be eligible with restrictions"

  # Test 16: Under 19, single with no dependants
  - name: "Under 19, not eligible"
    inputs:
      is_family: false
      working_income: 10000
      adjusted_net_income: 10000
      is_disabled: false
      age: 18
    expected:
      cwb_basic: 0
    notes: "Must be 19+ unless have spouse or dependants"

  # Test 17: Incarcerated (not eligible)
  - name: "Incarcerated, not eligible"
    inputs:
      is_family: false
      working_income: 10000
      adjusted_net_income: 10000
      is_disabled: false
      was_incarcerated: true
      days_incarcerated: 100
    expected:
      cwb_basic: 0
    notes: "Not eligible if incarcerated 90+ days"
