# Old Age Security Act - OAS and GIS Tests
#
# Test cases for validating Old Age Security (OAS) pension and
# Guaranteed Income Supplement (GIS) calculations.
# Uses 2024 payment amounts.
#
# 2024 OAS Amounts (January-March 2024):
# - Maximum monthly OAS (65-74): $713.34
# - Maximum monthly OAS (75+): $784.67
# - Maximum monthly GIS (single): $1,065.47
# - Maximum monthly GIS (couple, both receiving OAS): $641.35 each
#
# OAS Recovery Tax (clawback):
# - Threshold: $86,912 (2024)
# - Rate: 15%
# - Full clawback at: ~$142,609 (age 65-74) or ~$148,180 (age 75+)
#
# GIS Income Test:
# - Single: reduces based on individual income (excluding OAS)
# - Couple: based on combined income
#
# Reference: https://www.canada.ca/en/services/benefits/publicpensions/cpp/old-age-security.html

reference: "Old Age Security Act"
payment_year: 2024

tests:
  # ==========================================================================
  # OAS PENSION TESTS
  # ==========================================================================

  # Test 1: Full OAS, age 65-74
  - name: "Full OAS, age 65-74, zero income"
    inputs:
      age: 67
      years_of_residence_in_canada: 40
      individual_net_income: 0
    expected:
      oas_monthly: 713.34
      oas_annual: 8560.08
    notes: "Maximum OAS for 40+ years of residence"

  # Test 2: Full OAS, age 75+
  - name: "Full OAS, age 75+, zero income"
    inputs:
      age: 77
      years_of_residence_in_canada: 40
      individual_net_income: 0
    expected:
      oas_monthly: 784.67
      oas_annual: 9416.04
    notes: "10% bonus for 75+ since July 2022"

  # Test 3: Partial OAS (pro-rated)
  - name: "Partial OAS, 25 years residence"
    inputs:
      age: 67
      years_of_residence_in_canada: 25
      individual_net_income: 0
    expected:
      # 25/40 of maximum = 62.5%
      # $713.34 * 0.625 = $445.84
      oas_monthly: 445.84
    notes: "Prorated for less than 40 years residence"

  # Test 4: Minimum residence (10 years)
  - name: "Minimum OAS, 10 years residence"
    inputs:
      age: 67
      years_of_residence_in_canada: 10
      individual_net_income: 0
    expected:
      # 10/40 of maximum = 25%
      # $713.34 * 0.25 = $178.34
      oas_monthly: 178.34
    notes: "Minimum 10 years required"

  # Test 5: Under minimum residence (not eligible)
  - name: "Not eligible, 8 years residence"
    inputs:
      age: 67
      years_of_residence_in_canada: 8
      individual_net_income: 0
    expected:
      oas_monthly: 0
    notes: "Must have 10+ years residence"

  # Test 6: OAS clawback begins
  - name: "OAS with recovery tax starting"
    inputs:
      age: 67
      years_of_residence_in_canada: 40
      individual_net_income: 96912  # $10,000 above threshold
    expected:
      # Clawback: 15% of ($96,912 - $86,912) = $1,500/year
      # Annual OAS: $8,560 - $1,500 = $7,060
      oas_annual: 7060
      oas_monthly: 588.33
    notes: "Recovery tax kicks in above threshold"

  # Test 7: OAS fully clawed back
  - name: "High income, OAS fully clawed back"
    inputs:
      age: 67
      years_of_residence_in_canada: 40
      individual_net_income: 150000
    expected:
      # Clawback: 15% of ($150,000 - $86,912) = $9,463
      # Exceeds maximum OAS of $8,560
      oas_annual: 0
      oas_monthly: 0
    notes: "Full clawback at very high income"

  # Test 8: Under age 65 (not eligible)
  - name: "Under 65, not eligible"
    inputs:
      age: 64
      years_of_residence_in_canada: 40
      individual_net_income: 0
    expected:
      oas_monthly: 0
    notes: "Must be 65+ for OAS"

  # ==========================================================================
  # GUARANTEED INCOME SUPPLEMENT TESTS
  # ==========================================================================

  # Test 9: Full GIS, single, zero income
  - name: "Full GIS, single pensioner, zero income"
    inputs:
      age: 67
      is_single_pensioner: true
      individual_net_income: 0
      years_of_residence_in_canada: 40
    expected:
      gis_monthly: 1065.47
      gis_annual: 12785.64
    notes: "Maximum GIS for single with no other income"

  # Test 10: GIS with some income
  - name: "GIS reduced, single with pension income"
    inputs:
      age: 67
      is_single_pensioner: true
      individual_net_income: 10000  # excluding OAS
      years_of_residence_in_canada: 40
    expected:
      # GIS reduction: 50% of income
      # $10,000 * 0.50 = $5,000 reduction
      # $12,785.64 - $5,000 = $7,785.64
      gis_annual: 7785.64
    notes: "GIS reduces at 50% of income"

  # Test 11: GIS phased out
  - name: "GIS fully phased out"
    inputs:
      age: 67
      is_single_pensioner: true
      individual_net_income: 30000  # excluding OAS
      years_of_residence_in_canada: 40
    expected:
      # $30,000 * 0.50 = $15,000 reduction
      # Exceeds maximum GIS
      gis_annual: 0
    notes: "GIS phases out with higher income"

  # Test 12: Couple GIS
  - name: "Couple, both receiving OAS, low income"
    inputs:
      age: 67
      is_couple_both_oas: true
      combined_income: 5000  # excluding OAS
      years_of_residence_in_canada: 40
    expected:
      # Maximum couple GIS: $641.35 each monthly
      # Reduction based on combined income
      gis_monthly_each: 641.35
    notes: "Couple GIS rate is lower per person"

  # Test 13: GIS with partial OAS
  - name: "Partial OAS affects GIS"
    inputs:
      age: 67
      is_single_pensioner: true
      individual_net_income: 0
      years_of_residence_in_canada: 25
    expected:
      # Still eligible for full GIS even with partial OAS
      gis_monthly: 1065.47
    notes: "GIS is not reduced for partial OAS"

  # ==========================================================================
  # ALLOWANCE TESTS
  # ==========================================================================

  # Test 14: Allowance for spouse of OAS/GIS recipient
  - name: "Allowance for spouse age 60-64"
    inputs:
      age: 62
      spouse_receives_oas_gis: true
      years_of_residence_in_canada: 40
      individual_net_income: 0
    expected:
      # Allowance available for spouses age 60-64
      allowance_monthly: 1354.69  # Approximately OAS + GIS equivalent
    notes: "Allowance bridges gap until own OAS eligibility"

  # Test 15: Survivor Allowance
  - name: "Survivor allowance for widow(er)"
    inputs:
      age: 62
      is_survivor: true
      years_of_residence_in_canada: 40
      individual_net_income: 0
    expected:
      survivor_allowance_monthly: 1614.89
    notes: "Higher rate for survivors"

  # ==========================================================================
  # COMBINED OAS + GIS TESTS
  # ==========================================================================

  # Test 16: Maximum total benefits
  - name: "Maximum OAS + GIS, single"
    inputs:
      age: 67
      is_single_pensioner: true
      individual_net_income: 0
      years_of_residence_in_canada: 40
    expected:
      oas_monthly: 713.34
      gis_monthly: 1065.47
      total_monthly: 1778.81
      total_annual: 21345.72
    notes: "Combined maximum for single senior"

  # Test 17: Age 75+ bonus on OAS only
  - name: "Age 75+ with GIS"
    inputs:
      age: 77
      is_single_pensioner: true
      individual_net_income: 0
      years_of_residence_in_canada: 40
    expected:
      oas_monthly: 784.67  # 10% higher than 65-74
      gis_monthly: 1065.47  # Same as 65-74
      total_monthly: 1850.14
    notes: "Only OAS gets 75+ bonus, not GIS"
