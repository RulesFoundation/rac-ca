# BC Housing Benefit Tests
#
# Test cases for validating BC Housing Benefit calculations.
# Uses 2024 rates.
#
# The BC Housing Benefit provides rental assistance to low-income families.
#
# Maximum Monthly Amounts (2024):
#   - Single: N/A (not eligible unless senior/disability)
#   - Family with children: varies by family size and income
#   - Maximum varies by region (Metro Vancouver higher)
#
# Income threshold: Based on AFNI from prior tax year
#
# Reference: https://www.bchousing.org/housing-assistance/rental-assistance-programs/BC-rental-assistance-program

reference: "BC Housing Benefit"
year: 2024

tests:
  # ==========================================================================
  # BASIC ELIGIBILITY TESTS
  # ==========================================================================

  # Test 1: Family with children, low income
  - name: "Family with one child, very low income"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 1
      adjusted_family_net_income: 30000
      monthly_rent: 1800
      region: metro_vancouver
    expected:
      is_bc_housing_eligible: true
      bc_housing_benefit: 500  # Approximate
    notes: "Family below income threshold"

  # Test 2: Single parent family
  - name: "Single parent with two children"
    inputs:
      province: BC
      household_composition:
        adults: 1
        children: 2
      adjusted_family_net_income: 35000
      monthly_rent: 1500
      region: metro_vancouver
    expected:
      is_bc_housing_eligible: true
      bc_housing_benefit: 600  # Approximate
    notes: "Single parent eligible"

  # Test 3: Income above threshold
  - name: "Family income above threshold"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 1
      adjusted_family_net_income: 80000
      monthly_rent: 2000
      region: metro_vancouver
    expected:
      is_bc_housing_eligible: false
      bc_housing_benefit: 0
    notes: "Income too high"

  # Test 4: Single person (no children) - not eligible for family benefit
  - name: "Single person without children"
    inputs:
      province: BC
      household_composition:
        adults: 1
        children: 0
      adjusted_family_net_income: 25000
      monthly_rent: 1200
      region: metro_vancouver
    expected:
      is_bc_housing_eligible: false  # Must have children for family benefit
      bc_housing_benefit: 0
    notes: "Need children for family housing benefit"

  # ==========================================================================
  # REGIONAL VARIATIONS
  # ==========================================================================

  # Test 5: Metro Vancouver region
  - name: "Family in Metro Vancouver"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 2
      adjusted_family_net_income: 40000
      monthly_rent: 2200
      region: metro_vancouver
    expected:
      bc_housing_benefit: 600  # Higher limit in Metro Vancouver
    notes: "Metro Vancouver has higher rent limits"

  # Test 6: Other BC region
  - name: "Family outside Metro Vancouver"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 2
      adjusted_family_net_income: 40000
      monthly_rent: 1400
      region: other_bc
    expected:
      bc_housing_benefit: 400  # Lower limits outside Metro
    notes: "Different limits by region"

  # ==========================================================================
  # BENEFIT CALCULATION
  # ==========================================================================

  # Test 7: Rent below shelter threshold
  - name: "Low rent situation"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 1
      adjusted_family_net_income: 35000
      monthly_rent: 800  # Low rent
      region: metro_vancouver
    expected:
      # Benefit reduced when rent is low
      bc_housing_benefit: 300  # Lower benefit
    notes: "Benefit based on gap between rent and income contribution"

  # Test 8: Large family
  - name: "Large family benefit"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 4
      adjusted_family_net_income: 50000
      monthly_rent: 2500
      region: metro_vancouver
    expected:
      bc_housing_benefit: 800  # Higher for larger families
    notes: "Larger families may receive more assistance"

  # ==========================================================================
  # PHASE-OUT TESTS
  # ==========================================================================

  # Test 9: Income approaching threshold
  - name: "Income near phase-out"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 1
      adjusted_family_net_income: 55000
      monthly_rent: 1800
      region: metro_vancouver
    expected:
      # Benefit reduced at higher income
      bc_housing_benefit: 200
    notes: "Benefit phases out with income"

  # Test 10: At exact threshold
  - name: "Income at threshold"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 1
      adjusted_family_net_income: 60000
      monthly_rent: 1800
      region: metro_vancouver
    expected:
      bc_housing_benefit: 0
    notes: "No benefit at threshold"

  # ==========================================================================
  # SENIOR/DISABILITY HOUSING
  # ==========================================================================

  # Test 11: Senior without children
  - name: "Senior couple SAFER benefit"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 0
      adjusted_family_net_income: 30000
      monthly_rent: 1500
      age: 65
      region: metro_vancouver
    expected:
      is_safer_eligible: true
      safer_benefit: 400  # SAFER program for seniors
    notes: "Seniors access SAFER instead"

  # Test 12: Person with disability
  - name: "Person on disability assistance"
    inputs:
      province: BC
      household_composition:
        adults: 1
        children: 0
      adjusted_family_net_income: 20000
      monthly_rent: 1200
      receives_pwd: true  # Persons with Disabilities
      region: metro_vancouver
    expected:
      is_pwd_shelter_eligible: true
      pwd_shelter_supplement: 450  # Through PWD program
    notes: "PWD recipients have shelter supplements"

  # ==========================================================================
  # STACKING WITH OTHER BENEFITS
  # ==========================================================================

  # Test 13: Family also receiving CCB
  - name: "Family receiving CCB and housing"
    inputs:
      province: BC
      household_composition:
        adults: 2
        children: 2
      adjusted_family_net_income: 35000
      monthly_rent: 2000
      receives_ccb: true
      region: metro_vancouver
    expected:
      # CCB does not affect housing benefit eligibility
      is_bc_housing_eligible: true
      bc_housing_benefit: 600
    notes: "CCB excluded from income for housing"
